<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>간단한 캐러셀(슬라이드)</title>
    <link rel="stylesheet" href="../css/lab.css">
    <style>
        .carousel {
            --gap: 12px;
            display: grid;
            gap: 12px;
        }

        .carousel-viewport {
            overflow: hidden;
            border-radius: 12px;
        }

        .carousel-track {
            display: flex;
            gap: var(--gap);
            transition: transform .5s cubic-bezier(.22, .61, .36, 1);
            will-change: transform;
        }

        .slide {
            flex: 0 0 100%;
            height: 300px;
            border-radius: 12px;
            background: #0f1115 center/cover no-repeat;
        }

        nav {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        button {
            border: 1px solid #272b36;
            background: #0f1115;
            color: #ececf1;
            padding: 10px 14px;
            border-radius: 10px;
            cursor: pointer;
        }

        .dots {
            display: flex;
            gap: 8px;
        }

        .dot {
            width: 8px;
            height: 8px;
            border-radius: 999px;
            background: #2a2f3b;
            border: none;
        }

        .dot[aria-current="true"] {
            background: #79ffe1;
        }
    </style>
</head>

<body>
    <main class="wrap">
        <p class="return"><a href="../index.html">← 돌아가기</a></p>
        <h1>03 · Carousel (접근성 포함)</h1>
        <p class="lead">좌/우 버튼, 도트, 키보드, aria-live 안내</p>


        <div class="carousel" id="carousel" aria-label="갤러리">
            <div class="carousel-viewport">
                <div class="carousel-track" role="list" aria-live="polite">
                    <div class="slide" role="listitem" aria-label="1 / 4"
                        style="background-image:url('https://images.unsplash.com/photo-1517694712202-14dd9538aa97?q=80&w=1200&auto=format&fit=crop');">
                    </div>
                    <div class="slide" role="listitem" aria-label="2 / 4"
                        style="background-image:url('https://images.unsplash.com/photo-1498050108023-c5249f4df085?q=80&w=1200&auto=format&fit=crop');">
                    </div>
                    <div class="slide" role="listitem" aria-label="3 / 4"
                        style="background-image:url('https://images.unsplash.com/photo-1526498460520-4c246339dccb?q=80&w=1200&auto=format&fit=crop');">
                    </div>
                    <div class="slide" role="listitem" aria-label="4 / 4"
                        style="background-image:url('https://images.unsplash.com/photo-1551033406-611cf9a28f67?q=80&w=1200&auto=format&fit=crop');">
                    </div>
                </div>
            </div>
            <nav>
                <button type="button" id="prev">◀ 이전</button>
                <div class="dots" role="tablist" aria-label="슬라이드 선택">
                    <button class="dot" role="tab" aria-label="1번 슬라이드"></button>
                    <button class="dot" role="tab" aria-label="2번 슬라이드"></button>
                    <button class="dot" role="tab" aria-label="3번 슬라이드"></button>
                    <button class="dot" role="tab" aria-label="4번 슬라이드"></button>
                </div>
                <button type="button" id="next">다음 ▶</button>
            </nav>
        </div>
    </main>

    <script>
        const root = document.getElementById('carousel');
        const track = root.querySelector('.carousel-track');
        const slides = [...root.querySelectorAll('.slide')];
        const prevBtn = root.querySelector('#prev');
        const nextBtn = root.querySelector('#next');
        const dots = [...root.querySelectorAll('.dot')];
        let index = 0;


        const clamp = (n, min, max) => Math.min(max, Math.max(min, n));
        const update = () => {
            track.style.transform = `translateX(${-index * (track.clientWidth + 12)}px)`;
            dots.forEach((d, i) => d.setAttribute('aria-current', i === index ? 'true' : 'false'));
        };

        const setIndex = (i) => {
            index = clamp(i, 0, slides.length - 1);
            update();
        };


        window.addEventListener('resize', update);
        prevBtn.addEventListener('click', () => setIndex(index - 1));
        nextBtn.addEventListener('click', () => setIndex(index + 1));
        dots.forEach((d, i) => d.addEventListener('click', () => setIndex(i)));
        root.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowLeft') setIndex(index - 1);
            if (e.key === 'ArrowRight') setIndex(index + 1);
        });


        const vp = root.querySelector('.carousel-viewport');
        let startX = 0, dx = 0, dragging = false;

        vp.addEventListener('pointerdown', e => {
            dragging = true;
            startX = e.clientX;
            dx = 0;
            vp.style.cursor = 'grabbing';
        });

        vp.addEventListener('pointermove', e => {
            if (!dragging) return;
            dx = e.clientX - startX;
            track.style.transform = `translateX(${-(index * vp.clientWidth)}px + ${dx}px)`;
        });

        vp.addEventListener('pointerup', () => {
            if (!dragging) return;
            dragging = false;
            vp.style.cursor = '';

            if (Math.abs(dx) > 50) {
                setIndex(index + (dx < 0 ? 1 : -1));
            } else {
                update();
            }
        });
    </script>
</body>

</html>